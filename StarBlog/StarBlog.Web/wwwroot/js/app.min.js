const initTreeView=function(e){return $("#categories").treeview({data:e,levels:1,enableLinks:!0,highlightSelected:!1,showTags:!0,onNodeSelected:function(e,t){console.log(t)},onNodeUnselected:function(e,t){}})},initTreeView=function(e){return $("#post-toc-container").treeview({data:e,levels:2,enableLinks:!0,highlightSelected:!1,showTags:!0})};function procImages(e){$.get(`/Api/BlogPost/${e}/`,function(e){console.log("procImages",e);for(const s of document.querySelectorAll(".post-content img")){var t=s.getAttribute("src"),o=`/media/blog/${e.data.id}/`+t;console.log("originSrc",t),console.log("newSrc",o),s.setAttribute("src",o)}})}$(function(){var e;document.getElementById("post-markdown-content")&&(e=editormd.markdownToHTML("post-markdown-content",{htmlDecode:!0,tocm:!0,emoji:!0,taskList:!0,tex:!0,flowChart:!0,sequenceDiagram:!0}),initTreeView(e.markdownTocTree))}),function(d,t,e,i){"use strict";function n(e,t){return this.$element=d(e),this.elementId=e.id,this.styleId=this.elementId+"-style",this.init(t),{options:this.options,init:d.proxy(this.init,this),remove:d.proxy(this.remove,this),getNode:d.proxy(this.getNode,this),getParent:d.proxy(this.getParent,this),getSiblings:d.proxy(this.getSiblings,this),getSelected:d.proxy(this.getSelected,this),getUnselected:d.proxy(this.getUnselected,this),getExpanded:d.proxy(this.getExpanded,this),getCollapsed:d.proxy(this.getCollapsed,this),getChecked:d.proxy(this.getChecked,this),getUnchecked:d.proxy(this.getUnchecked,this),getDisabled:d.proxy(this.getDisabled,this),getEnabled:d.proxy(this.getEnabled,this),selectNode:d.proxy(this.selectNode,this),unselectNode:d.proxy(this.unselectNode,this),toggleNodeSelected:d.proxy(this.toggleNodeSelected,this),collapseAll:d.proxy(this.collapseAll,this),collapseNode:d.proxy(this.collapseNode,this),expandAll:d.proxy(this.expandAll,this),expandNode:d.proxy(this.expandNode,this),toggleNodeExpanded:d.proxy(this.toggleNodeExpanded,this),revealNode:d.proxy(this.revealNode,this),checkAll:d.proxy(this.checkAll,this),checkNode:d.proxy(this.checkNode,this),uncheckAll:d.proxy(this.uncheckAll,this),uncheckNode:d.proxy(this.uncheckNode,this),toggleNodeChecked:d.proxy(this.toggleNodeChecked,this),disableAll:d.proxy(this.disableAll,this),disableNode:d.proxy(this.disableNode,this),enableAll:d.proxy(this.enableAll,this),enableNode:d.proxy(this.enableNode,this),toggleNodeDisabled:d.proxy(this.toggleNodeDisabled,this),search:d.proxy(this.search,this),clearSearch:d.proxy(this.clearSearch,this)}}function a(e){t.console&&t.console.error(e)}let r="treeview",l={};l.settings={injectStyle:!0,levels:2,expandIcon:"fa fa-chevron-right",collapseIcon:"fa fa-chevron-down",emptyIcon:"fa",nodeIcon:"",selectedIcon:"",checkedIcon:"fa fa-check-circle-o",uncheckedIcon:"fa fa-circle-thin",color:i,backColor:i,borderColor:i,onhoverColor:"#F5F5F5",selectedColor:"#FFFFFF",selectedBackColor:"#428bca",searchResultColor:"#D9534F",searchResultBackColor:i,enableLinks:!1,enableIndent:!0,highlightSelected:!0,highlightSearchResults:!0,showBorder:!0,showIcon:!0,showCheckbox:!1,showTags:!1,multiSelect:!1,onNodeChecked:i,onNodeCollapsed:i,onNodeDisabled:i,onNodeEnabled:i,onNodeExpanded:i,onNodeSelected:i,onNodeUnchecked:i,onNodeUnselected:i,onSearchComplete:i,onSearchCleared:i},l.options={silent:!1,ignoreChildren:!1},l.searchOptions={ignoreCase:!0,exactMatch:!1,revealResults:!0},n.prototype.init=function(e){this.tree=[],this.nodes=[],e.data&&("string"==typeof e.data&&(e.data=d.parseJSON(e.data)),this.tree=d.extend(!0,[],e.data),delete e.data),this.options=d.extend({},l.settings,e),this.destroy(),this.subscribeEvents(),this.setInitialStates({nodes:this.tree},0),this.render()},n.prototype.remove=function(){this.destroy(),d.removeData(this,r),d("#"+this.styleId).remove()},n.prototype.destroy=function(){this.initialized&&(this.$wrapper.remove(),this.$wrapper=null,this.unsubscribeEvents(),this.initialized=!1)},n.prototype.unsubscribeEvents=function(){this.$element.off("click"),this.$element.off("nodeChecked"),this.$element.off("nodeCollapsed"),this.$element.off("nodeDisabled"),this.$element.off("nodeEnabled"),this.$element.off("nodeExpanded"),this.$element.off("nodeSelected"),this.$element.off("nodeUnchecked"),this.$element.off("nodeUnselected"),this.$element.off("searchComplete"),this.$element.off("searchCleared")},n.prototype.subscribeEvents=function(){this.unsubscribeEvents(),this.$element.on("click",d.proxy(this.clickHandler,this)),"function"==typeof this.options.onNodeChecked&&this.$element.on("nodeChecked",this.options.onNodeChecked),"function"==typeof this.options.onNodeCollapsed&&this.$element.on("nodeCollapsed",this.options.onNodeCollapsed),"function"==typeof this.options.onNodeDisabled&&this.$element.on("nodeDisabled",this.options.onNodeDisabled),"function"==typeof this.options.onNodeEnabled&&this.$element.on("nodeEnabled",this.options.onNodeEnabled),"function"==typeof this.options.onNodeExpanded&&this.$element.on("nodeExpanded",this.options.onNodeExpanded),"function"==typeof this.options.onNodeSelected&&this.$element.on("nodeSelected",this.options.onNodeSelected),"function"==typeof this.options.onNodeUnchecked&&this.$element.on("nodeUnchecked",this.options.onNodeUnchecked),"function"==typeof this.options.onNodeUnselected&&this.$element.on("nodeUnselected",this.options.onNodeUnselected),"function"==typeof this.options.onSearchComplete&&this.$element.on("searchComplete",this.options.onSearchComplete),"function"==typeof this.options.onSearchCleared&&this.$element.on("searchCleared",this.options.onSearchCleared)},n.prototype.setInitialStates=function(e,i){if(e.nodes){i+=1;let o=e,s=this;d.each(e.nodes,function(e,t){t.nodeId=s.nodes.length,t.parentId=o.nodeId,t.hasOwnProperty("selectable")||(t.selectable=!1),t.state=t.state||{},t.state.hasOwnProperty("checked")||(t.state.checked=!1),t.state.hasOwnProperty("disabled")||(t.state.disabled=!1),t.state.hasOwnProperty("expanded")||(!t.state.disabled&&i<s.options.levels&&t.nodes&&0<t.nodes.length?t.state.expanded=!0:t.state.expanded=!1),t.state.hasOwnProperty("selected")||(t.state.selected=!1),s.nodes.push(t),t.nodes&&s.setInitialStates(t,i)})}},n.prototype.clickHandler=function(e){this.options.enableLinks||e.preventDefault();var e=d(e.target),t=this.findNode(e);t&&!t.state.disabled&&(-1!==(e=e.attr("class")?e.attr("class").split(" "):[]).indexOf("expand-icon")?this.toggleExpandedState(t,l.options):-1!==e.indexOf("check-icon")?this.toggleCheckedState(t,l.options):t.selectable?this.toggleSelectedState(t,l.options):this.toggleExpandedState(t,l.options),this.render())},n.prototype.findNode=function(e){e=e.closest("li.list-group-item").attr("data-nodeid"),e=this.nodes[e];return e||console.log("Error: node does not exist"),e},n.prototype.toggleExpandedState=function(e,t){e&&this.setExpandedState(e,!e.state.expanded,t)},n.prototype.setExpandedState=function(e,t,o){t!==e.state.expanded&&(t&&e.nodes?(e.state.expanded=!0,o.silent||this.$element.trigger("nodeExpanded",d.extend(!0,{},e))):t||(e.state.expanded=!1,o.silent||this.$element.trigger("nodeCollapsed",d.extend(!0,{},e)),e.nodes&&!o.ignoreChildren&&d.each(e.nodes,d.proxy(function(e,t){this.setExpandedState(t,!1,o)},this))))},n.prototype.toggleSelectedState=function(e,t){e&&this.setSelectedState(e,!e.state.selected,t)},n.prototype.setSelectedState=function(e,t,o){t!==e.state.selected&&(t?(this.options.multiSelect||d.each(this.findNodes("true","g","state.selected"),d.proxy(function(e,t){this.setSelectedState(t,!1,o)},this)),e.state.selected=!0,o.silent||this.$element.trigger("nodeSelected",d.extend(!0,{},e))):(e.state.selected=!1,o.silent||this.$element.trigger("nodeUnselected",d.extend(!0,{},e))))},n.prototype.toggleCheckedState=function(e,t){e&&this.setCheckedState(e,!e.state.checked,t)},n.prototype.setCheckedState=function(e,t,o){t!==e.state.checked&&(t?(e.state.checked=!0,o.silent||this.$element.trigger("nodeChecked",d.extend(!0,{},e))):(e.state.checked=!1,o.silent||this.$element.trigger("nodeUnchecked",d.extend(!0,{},e))))},n.prototype.setDisabledState=function(e,t,o){t!==e.state.disabled&&(t?(e.state.disabled=!0,this.setExpandedState(e,!1,o),this.setSelectedState(e,!1,o),this.setCheckedState(e,!1,o),o.silent||this.$element.trigger("nodeDisabled",d.extend(!0,{},e))):(e.state.disabled=!1,o.silent||this.$element.trigger("nodeEnabled",d.extend(!0,{},e))))},n.prototype.render=function(){this.initialized||(this.$element.addClass(r),this.$wrapper=d(this.template.list),this.injectStyle(),this.initialized=!0),this.$element.empty().append(this.$wrapper.empty()),this.buildTree(this.tree,0)},n.prototype.buildTree=function(e,r){if(e){r+=1;let a=this;d.each(e,function(e,t){var o=d(a.template.itemWrapper).addClass("node-"+a.elementId).addClass(t.state.checked?"node-checked":"").addClass(t.state.disabled?"node-disabled":"").addClass(t.state.selected?"node-selected":"").addClass(t.searchResult?"search-result":"").attr("data-nodeid",t.nodeId).attr("style",a.buildStyleOverride(t)),s=d(a.template.itemLeftElem);let i=d(a.template.itemRightElem);if(o.append(s),o.append(i),a.options.enableIndent)for(let e=0;e<r-1;e++)s.append(a.template.indent);var n=[];if(t.nodes?(n.push("expand-icon"),t.state.expanded?n.push(a.options.collapseIcon):n.push(a.options.expandIcon)):n.push(a.options.emptyIcon),s.append(d(a.template.icon).addClass(n.join(" "))),a.options.showIcon&&((n=["node-icon"]).push(t.icon||a.options.nodeIcon),t.state.selected&&(n.pop(),n.push(t.selectedIcon||a.options.selectedIcon||t.icon||a.options.nodeIcon)),s.append(d(a.template.icon).addClass(n.join(" ")))),a.options.showCheckbox&&(n=["check-icon"],t.state.checked?n.push(a.options.checkedIcon):n.push(a.options.uncheckedIcon),s.append(d(a.template.icon).addClass(n.join(" ")))),a.options.enableLinks?s.append(d(a.template.link).attr("href",t.href).append(t.text)):s.append(t.text),a.options.showTags&&t.tags&&d.each(t.tags,function(e,t){i.append(d(a.template.badge).append(t))}),a.$wrapper.append(o),t.nodes&&t.state.expanded&&!t.state.disabled)return a.buildTree(t.nodes,r)})}},n.prototype.buildStyleOverride=function(e){if(e.state.disabled)return"";let t=e.color,o=e.backColor;return this.options.highlightSelected&&e.state.selected&&(this.options.selectedColor&&(t=this.options.selectedColor),this.options.selectedBackColor)&&(o=this.options.selectedBackColor),this.options.highlightSearchResults&&e.searchResult&&!e.state.disabled&&(this.options.searchResultColor&&(t=this.options.searchResultColor),this.options.searchResultBackColor)&&(o=this.options.searchResultBackColor),"color:"+t+";background-color:"+o+";"},n.prototype.injectStyle=function(){this.options.injectStyle&&!e.getElementById(this.styleId)&&d('<style type="text/css" id="'+this.styleId+'"> '+this.buildStyle()+" </style>").appendTo("head")},n.prototype.buildStyle=function(){let e=".node-"+this.elementId+"{";return this.options.color&&(e+="color:"+this.options.color+";"),this.options.backColor&&(e+="background-color:"+this.options.backColor+";"),this.options.showBorder?this.options.borderColor&&(e+="border:1px solid "+this.options.borderColor+";"):e+="border:none;",e+="}",this.options.onhoverColor&&(e+=".node-"+this.elementId+":not(.node-disabled):hover{background-color:"+this.options.onhoverColor+";}"),this.css+e},n.prototype.template={list:'<ul class="list-group"></ul>',itemWrapper:'<li class="list-group-item d-flex justify-content-between align-items-start"></li>',itemLeftElem:'<div class="w-100"></div>',itemRightElem:"<div></div>",indent:'<span class="mx-1"></span>',icon:'<span class="icon"></span>',link:'<a class="w-75" href="#" style="display:inline-block; color:inherit; text-decoration:none;"></a>',badge:'<span class="ml-1 badge bg-primary rounded-pill"></span>'},n.prototype.css=".treeview .list-group-item{cursor:pointer}.treeview span.icon{width:12px;margin-right:5px}.treeview .node-disabled{color:silver;cursor:not-allowed}",n.prototype.getNode=function(e){return this.nodes[e]},n.prototype.getParent=function(e){e=this.identifyNode(e);return this.nodes[e.parentId]},n.prototype.getSiblings=function(e){let t=this.identifyNode(e);e=this.getParent(t);return(e?e.nodes:this.tree).filter(function(e){return e.nodeId!==t.nodeId})},n.prototype.getSelected=function(){return this.findNodes("true","g","state.selected")},n.prototype.getUnselected=function(){return this.findNodes("false","g","state.selected")},n.prototype.getExpanded=function(){return this.findNodes("true","g","state.expanded")},n.prototype.getCollapsed=function(){return this.findNodes("false","g","state.expanded")},n.prototype.getChecked=function(){return this.findNodes("true","g","state.checked")},n.prototype.getUnchecked=function(){return this.findNodes("false","g","state.checked")},n.prototype.getDisabled=function(){return this.findNodes("true","g","state.disabled")},n.prototype.getEnabled=function(){return this.findNodes("false","g","state.disabled")},n.prototype.selectNode=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.setSelectedState(e,!0,t)},this)),this.render()},n.prototype.unselectNode=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.setSelectedState(e,!1,t)},this)),this.render()},n.prototype.toggleNodeSelected=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.toggleSelectedState(e,t)},this)),this.render()},n.prototype.collapseAll=function(e){var t=this.findNodes("true","g","state.expanded");this.forEachIdentifier(t,e,d.proxy(function(e,t){this.setExpandedState(e,!1,t)},this)),this.render()},n.prototype.collapseNode=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.setExpandedState(e,!1,t)},this)),this.render()},n.prototype.expandAll=function(e){var t;(e=d.extend({},l.options,e))&&e.levels?this.expandLevels(this.tree,e.levels,e):(t=this.findNodes("false","g","state.expanded"),this.forEachIdentifier(t,e,d.proxy(function(e,t){this.setExpandedState(e,!0,t)},this))),this.render()},n.prototype.expandNode=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.setExpandedState(e,!0,t),e.nodes&&t&&t.levels&&this.expandLevels(e.nodes,t.levels-1,t)},this)),this.render()},n.prototype.expandLevels=function(e,o,s){s=d.extend({},l.options,s),d.each(e,d.proxy(function(e,t){this.setExpandedState(t,0<o,s),t.nodes&&this.expandLevels(t.nodes,o-1,s)},this))},n.prototype.revealNode=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){let o=this.getParent(e);for(;o;)this.setExpandedState(o,!0,t),o=this.getParent(o)},this)),this.render()},n.prototype.toggleNodeExpanded=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.toggleExpandedState(e,t)},this)),this.render()},n.prototype.checkAll=function(e){var t=this.findNodes("false","g","state.checked");this.forEachIdentifier(t,e,d.proxy(function(e,t){this.setCheckedState(e,!0,t)},this)),this.render()},n.prototype.checkNode=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.setCheckedState(e,!0,t)},this)),this.render()},n.prototype.uncheckAll=function(e){var t=this.findNodes("true","g","state.checked");this.forEachIdentifier(t,e,d.proxy(function(e,t){this.setCheckedState(e,!1,t)},this)),this.render()},n.prototype.uncheckNode=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.setCheckedState(e,!1,t)},this)),this.render()},n.prototype.toggleNodeChecked=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.toggleCheckedState(e,t)},this)),this.render()},n.prototype.disableAll=function(e){var t=this.findNodes("false","g","state.disabled");this.forEachIdentifier(t,e,d.proxy(function(e,t){this.setDisabledState(e,!0,t)},this)),this.render()},n.prototype.disableNode=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.setDisabledState(e,!0,t)},this)),this.render()},n.prototype.enableAll=function(e){var t=this.findNodes("true","g","state.disabled");this.forEachIdentifier(t,e,d.proxy(function(e,t){this.setDisabledState(e,!1,t)},this)),this.render()},n.prototype.enableNode=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.setDisabledState(e,!1,t)},this)),this.render()},n.prototype.toggleNodeDisabled=function(e,t){this.forEachIdentifier(e,t,d.proxy(function(e,t){this.setDisabledState(e,!e.state.disabled,t)},this)),this.render()},n.prototype.forEachIdentifier=function(e,o,s){o=d.extend({},l.options,o),e instanceof Array||(e=[e]),d.each(e,d.proxy(function(e,t){s(this.identifyNode(t),o)},this))},n.prototype.identifyNode=function(e){return"number"==typeof e?this.nodes[e]:e},n.prototype.search=function(t,o){o=d.extend({},l.searchOptions,o),this.clearSearch({render:!1});let s=[];if(t&&0<t.length){o.exactMatch&&(t="^"+t+"$");let e="g";o.ignoreCase&&(e+="i"),s=this.findNodes(t,e),d.each(s,function(e,t){t.searchResult=!0})}return o.revealResults?this.revealNode(s):this.render(),this.$element.trigger("searchComplete",d.extend(!0,{},s)),s},n.prototype.clearSearch=function(e){e=d.extend({},{render:!0},e);var t=d.each(this.findNodes("true","g","searchResult"),function(e,t){t.searchResult=!1});e.render&&this.render(),this.$element.trigger("searchCleared",d.extend(!0,{},t))},n.prototype.findNodes=function(t,o,s){o=o||"g",s=s||"text";let i=this;return d.grep(this.nodes,function(e){e=i.getNodeValue(e,s);if("string"==typeof e)return e.match(new RegExp(t,o))})},n.prototype.getNodeValue=function(e,t){var o,s=t.indexOf(".");return 0<s?(o=e[t.substring(0,s)],s=t.substring(s+1,t.length),this.getNodeValue(o,s)):e.hasOwnProperty(t)?e[t].toString():i};d.fn[r]=function(t,o){let s;return this.each(function(){var e=d.data(this,r);"string"==typeof t?e?d.isFunction(e[t])&&"_"!==t.charAt(0)?(o instanceof Array||(o=[o]),s=e[t].apply(e,o)):a("No such method : "+t):a("Not initialized, can not call method : "+t):"boolean"==typeof t?s=e:d.data(this,r,new n(this,d.extend(!0,{},t)))}),s||this}}(jQuery,window,document),new Vue({el:"#vue-comment",data:{comments:[],total:0,page:1,pageSize:5,search:"",sortBy:"",refreshLoading:!0,submitLoading:!1,emailDisabled:!1,emailOtpDisabled:!1,getEmailOtpDisabled:!1,getEmailOtpLoading:!1,userNameDisabled:!0,userNameLoading:!1,urlDisabled:!0,urlLoading:!1,contentDisabled:!0,submitDisabled:!0,replyDisabled:!0,replyComment:null,getEmailOtpText:"获取",otpInterval:null,form:{parentId:"",postId:POST_ID,userName:"",email:"",emailOtp:"",url:"",content:""},formRules:{userName:[{required:!0,message:"请输入用户名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确"}],emailOtp:[{required:!0,message:"请输入邮箱验证码",trigger:"change"},{len:4,message:"长度 4 个字符",trigger:"change"}],url:[{type:"url",message:"请输入正确的url",trigger:"blur"}],content:[{required:!0,message:"请输入评论内容",trigger:"blur"},{min:1,max:300,message:"长度 在 1 到 300 个字符",trigger:"blur"}]}},created:async function(){await this.getComments(),this.refreshLoading=!1},methods:{getEmailOtp(o){return new Promise((t,e)=>{axios.get("/Api/Comment/GetEmailOtp?email="+o).then(e=>t(e.data)).catch(e=>t(e.response.data))})},getAnonymousUser(o,s){return new Promise((t,e)=>{axios.get(`/Api/Comment/GetAnonymousUser?email=${o}&otp=`+s).then(e=>t(e.data)).catch(e=>t(e.response.data))})},getComments(){let o={PostId:POST_ID,Page:this.page,PageSize:this.pageSize};return this.search&&(o.Search=this.search),this.sortBy&&(o.SortBy=this.sortBy),new Promise((t,e)=>{axios.get("/Api/Comment",{params:o}).then(e=>{this.comments=e.data.data.map(e=>{var t={...e,anonymousUser:{...e.anonymousUser,createdTime:dayjs(e.anonymousUser.createdTime).format("YYYY-MM-DD"),updatedTime:dayjs(e.anonymousUser.updatedTime).format("YYYY-MM-DD")},createdTime:dayjs(e.createdTime).format("YYYY-MM-DD"),updatedTime:dayjs(e.updatedTime).format("YYYY-MM-DD"),avatar:"/Api/PicLib/Random/100/100?Seed="+e.anonymousUserId};return e.parent&&(t.replyUser=e.parent.anonymousUser.name),t}),this.total=e.data.pagination.totalItemCount,t(e)}).catch(e=>{console.log(e);e=e.response.data;t(e)})})},submitComment(o){return new Promise((t,e)=>{axios.post("/Api/Comment",{...o}).then(e=>t(e.data)).catch(e=>t(e.response.data))})},async handleRefresh(){this.refreshLoading=!0,await this.getComments(),this.refreshLoading=!1},async handleGetEmailOtp(){if(this.form.email){this.getEmailOtpLoading=!0;var t=await this.getEmailOtp(this.form.email);if(this.getEmailOtpLoading=!1,t.successful){this.$message.success(t.message);let e=300;this.getEmailOtpText=e+"s",this.otpInterval=setInterval(()=>{0<--e?(this.getEmailOtpText=e+"s",this.getEmailOtpDisabled=!0):(e=300,this.getEmailOtpText="获取",this.otpInterval&&clearInterval(this.otpInterval),this.getEmailOtpDisabled=!1)},1e3)}else this.$message.error(t.message)}else this.$message.error("请输入邮箱地址！")},async handleEmailOtpChange(e){console.log("handleEmailOtpChange",e),0===this.form.email?.length||e.length<4||(this.userNameLoading=!0,this.urlLoading=!0,e=await this.getAnonymousUser(this.form.email,e),console.log(e),e.successful?(e.data.anonymousUser&&(this.form.userName=e.data.anonymousUser.name,this.form.url=e.data.anonymousUser.url),this.form.emailOtp=e.data.newOtp,this.getEmailOtpDisabled=!0,this.emailDisabled=!0,this.emailOtpDisabled=!0,this.userNameDisabled=!1,this.urlDisabled=!1,this.contentDisabled=!1,this.submitDisabled=!1,this.replyDisabled=!1):this.$message.error(e.message),this.userNameLoading=!1,this.urlLoading=!1)},handleUrlBlur(){this.form.url.startsWith("http")||(this.form.url="http://"+this.form.url)},handleReset(){this.$refs.form.resetFields(),this.otpInterval&&clearInterval(this.otpInterval),this.getEmailOtpText="获取",this.emailDisabled=!1,this.emailOtpDisabled=!1,this.getEmailOtpDisabled=!1,this.userNameDisabled=!0,this.urlDisabled=!0,this.contentDisabled=!0,this.submitDisabled=!0,this.replyDisabled=!0,this.form.parentId="",this.replyComment=null},async handleSubmit(){this.$refs.form.validate(async e=>{var t;e&&(this.submitLoading=!0,(e=await this.submitComment(this.form)).successful?(this.$message.success(e.message),t=""+this.form.email,this.handleReset(),this.form.email=t):this.$message.error(e.message),this.submitLoading=!1,await this.getComments())})},async handleSizeChange(e){this.pageSize=e,await this.handleRefresh()},async handleCurrentChange(e){this.page=e,await this.handleRefresh()},async handleReply(e){this.replyComment=e,this.form.parentId=e.id,this.$refs.content.focus()},handleReplyTagClose(){this.form.parentId="",this.replyComment=null}}});const HEIGHT=400;let homeApp=new Vue({el:"#vue-app",data:{poem:{},hitokoto:{},poemSimple:"",chartTypes:["bubble","bar"],currentChartTypeIndex:0,currentChart:null},computed:{chartElem(){return document.getElementById("myChart")}},created(){this.loadPoem(),this.loadHitokoto()},mounted(){!0===CHART_VISIBLE&&this.loadChart()},methods:{loadPoem(){fetch("/Api/DataAcq/Poem").then(e=>e.json()).then(e=>this.poemSimple=e.data)},loadHitokoto(){fetch("/Api/DataAcq/Hitokoto").then(e=>e.json()).then(e=>this.hitokoto=e.data)},randomRGB(){return"rgb("+this.randomColorArray().join(",")+")"},randomRGBA(e){return this.convertRGBA(this.randomColorArray(),e)},convertRGBA(e,t){e=Array.from(e);return e.push(t),"rgba("+e.join(",")+")"},randomColorArray(){return[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())]},switchChartType(){this.currentChartTypeIndex>=this.chartTypes.length-1?this.currentChartTypeIndex=0:this.currentChartTypeIndex++,this.currentChart&&this.currentChart.destroy(),this.chartElem.setAttribute("style",""),this.loadChart()},loadChart(){switch(this.chartTypes[this.currentChartTypeIndex]){case"bubble":this.loadBubbleChart();break;case"bar":this.loadBarChart()}},loadBubbleChart(){fetch("/Api/Category/WordCloud").then(e=>e.json()).then(e=>{let o=[];e.data.forEach(e=>{var t=this.randomColorArray();o.push({label:e.name,data:[{x:Math.round(50*Math.random()),y:Math.round(50*Math.random()),r:e.value}],backgroundColor:this.convertRGBA(t,.2),borderColor:this.convertRGBA(t,1),borderWidth:1})});e={datasets:o};this.currentChart=new Chart(this.chartElem,{type:"bubble",data:e,options:{maintainAspectRatio:!1}}),this.currentChart.resize(null,HEIGHT)})},loadBarChart(){fetch("/Api/Category/WordCloud").then(e=>e.json()).then(e=>{let t=[],o=[],s=[],i=[];e.data.forEach(e=>{t.push(e.name),o.push(e.value);e=this.randomColorArray();s.push(this.convertRGBA(e,.2)),i.push(this.convertRGBA(e,1))});e={labels:t,datasets:[{label:"# of Votes",data:o,backgroundColor:s,borderColor:i,borderWidth:1}]};this.currentChart=new Chart(this.chartElem,{type:"bar",data:e,options:{maintainAspectRatio:!1}}),this.currentChart.resize(null,HEIGHT)})}}});console.log("Enable tooltips");const tooltipTriggerList=document.querySelectorAll('[data-bs-toggle="tooltip"]'),tooltipList=[...tooltipTriggerList].map(e=>new bootstrap.Tooltip(e));let $grid=$("#photo-grid").masonry({itemSelector:".grid-item",percentPosition:!0}),app=($grid.imagesLoaded().progress(function(){$grid.masonry("layout")}),new Vue({el:"#vue-header",data:{currentTheme:"",themes:[]},created:function(){fetch("/Api/Theme").then(e=>e.json()).then(e=>{this.themes=e.data});var e=localStorage.getItem("currentTheme");null!=e&&(this.currentTheme=e)},methods:{setTheme(t){var e=this.themes.find(e=>e.name===t);loadStyles(e.cssUrl),this.currentTheme=t,localStorage.setItem("currentTheme",t),localStorage.setItem("currentThemeCssUrl",e.cssUrl),location.reload()}}})),toastTrigger=document.getElementById("liveToastBtn"),toastLiveExample=document.getElementById("liveToast");function loadStyles(e){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}toastTrigger&&toastTrigger.addEventListener("click",function(){new bootstrap.Toast(toastLiveExample).show()});let currentTheme=localStorage.getItem("currentTheme");if("Bootstrap"!==currentTheme){let e=localStorage.getItem("currentThemeCssUrl");null!=e&&loadStyles(e)}